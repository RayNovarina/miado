<% if locals[:num_team_items] == 0 %>
  <h3><u><%= link_to locals[:auth_info]['team'],
                  team_path(locals[:installation]),
                  title: "Created on #{locals[:installation].created_at.in_time_zone("Pacific Time (US & Canada)").strftime('%a %B %e, %Y %l:%M%P - PT')}" %>
      </u>
      &nbsp;&nbsp;<%= "#{locals[:num_team_members]} Active #{'member'.pluralize(locals[:num_team_members])} with #{pluralize(locals[:num_team_items], 'Task')} in #{locals[:num_team_channels]} Active #{'*Channel'.pluralize(locals[:num_team_channels])}*" %>
  </h3>
<% else %>
<h3 style="padding-bottom: 14px; margin-top: 0px;">
    <u><%= link_to locals[:auth_info]['team'],
                team_path(locals[:installation]),
                title: "Created on #{locals[:installation].created_at.in_time_zone("Pacific Time (US & Canada)").strftime('%a %B %e, %Y %l:%M%P - PT')}" %>
    </u>
    &nbsp;&nbsp;<%= "#{locals[:num_team_members]} Active #{'member'.pluralize(locals[:num_team_members])} with #{pluralize(locals[:num_team_items], 'Task')} in #{locals[:num_team_channels]} Active #{'*Channel'.pluralize(locals[:num_team_channels])}*" %>
</h3>
<%
  current_channel_id = ''
  task_num = 0
  most_recent_task = nil
  locals[:team_items].each_with_index do |item, index|
    unless current_channel_id == item.channel_id
      unless current_channel_id == '' %>
           </tbody>
          </table>
        <br>
      <% end %>
      <% current_channel_id = item.channel_id
         task_num = 1
         most_recent_task = locals[:team_items][index]
         locals[:team_items][index..-1].each do |item_for_this_channel|
           break unless item_for_this_channel.channel_id == current_channel_id
           most_recent_task = item_for_this_channel if item_for_this_channel.updated_at > most_recent_task.updated_at
         end
      %>
      <h4 style="margin-top: 0px;">
          Channel: <u><%= link_to "##{item.channel_name}" %>"</u>
          <%= "(#{current_channel_id})" %>
      </h4>
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <th>Task<br>Num<br>(Id)</th>
              <th>Description<br>[debug trace]</th>
              <th>Assigned To</th>
              <th>Due Date</th>
              <th>Open<br>Done</th>
              <th>Created by<br>@Date</th>
              <th>Last Update by<br>@Date (now)<br>
                (<%= DateTime.current.in_time_zone("Pacific Time (US & Canada)").strftime('%a %B %e, %Y %l:%M%P - PT') %>)
                <br><span class="alert-info">[Most Recent]</span>
              </th>
            </tr>
          </thead>
          <tbody>
    <% end %>
    <%= render partial: 'items/admin_views/index_item',
               locals: { locals: { task_num: task_num,
                                   item: item,
                                   is_last_updated_item: item.updated_at == most_recent_task.updated_at
                                 }
                       }
    %>
    <% task_num += 1
    %>
  <% end %>
  <% unless current_channel_id == '' %>
           </tbody>
         </table>
       <br>
  <% end %>
<% end %>
